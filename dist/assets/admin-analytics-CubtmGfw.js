import{j as e,u as g}from"./query-vendor-6bJJjEwk.js";import{a as E}from"./react-vendor-WvRYOV97.js";import{x as R,y as I,v as K,s as z,U as H,o as Y,G as P,H as G}from"./ui-vendor-CUjeC3OF.js";import{s as u,L as v}from"./admin-B6lP1v0G.js";import{u as V,E as J}from"./admin-meetings-CQJFkfjK.js";const D=({title:s,value:r,change:a,icon:t,color:l,subtitle:n})=>{const o=a!==void 0&&a>0,c=a!==void 0&&a<0;return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 p-6 hover:bg-white/10 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center transition-transform hover:scale-110",style:{backgroundColor:`${l}20`},children:e.jsx("div",{style:{color:l},children:t})}),a!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-semibold ${o?"bg-green-500/20 text-green-400":c?"bg-red-500/20 text-red-400":"bg-gray-500/20 text-gray-400"}`,children:[o&&e.jsx(R,{className:"w-3 h-3"}),c&&e.jsx(I,{className:"w-3 h-3"}),e.jsxs("span",{children:[a>0?"+":"",a,"%"]})]})]}),e.jsx("h3",{className:"text-gray-400 text-sm mb-2",children:s}),e.jsx("p",{className:"text-3xl font-bold text-white mb-1",children:r}),n&&e.jsx("p",{className:"text-xs text-gray-500",children:n})]})},j=({title:s,children:r,subtitle:a})=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:s}),a&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:a})]}),e.jsx("div",{className:"min-h-[300px]",children:r})]}),A={pending:{label:"En attente",color:"bg-yellow-500/20 text-yellow-400"},confirmed:{label:"Confirmé",color:"bg-green-500/20 text-green-400"},completed:{label:"Terminé",color:"bg-blue-500/20 text-blue-400"},cancelled:{label:"Annulé",color:"bg-red-500/20 text-red-400"},no_show:{label:"Absent",color:"bg-gray-500/20 text-gray-400"}},w=({status:s,count:r})=>{const a=A[s]||A.pending;return e.jsxs("div",{className:`px-3 py-2 rounded-lg ${a.color} flex items-center justify-between`,children:[e.jsx("span",{className:"text-sm font-medium",children:a.label}),e.jsx("span",{className:"text-lg font-bold ml-2",children:r})]})},L=({data:s,maxValue:r})=>{const a=r||Math.max(...s.map(t=>t.value),1);return e.jsx("div",{className:"space-y-4",children:s.map((t,l)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-300",children:t.label}),e.jsx("span",{className:"text-sm font-bold text-white",children:t.value})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${t.value/a*100}%`,backgroundColor:t.color}})})]},l))})},U=({data:s})=>{const r=s.reduce((a,t)=>a+t.value,0);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:s.reduce((a,t,l)=>{const n=t.value/r*100,o=-a;return[...a,o+n]},[0]).slice(0,-1).map((a,t)=>{const l=s[t],n=l.value/r*100;return e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:l.color,strokeWidth:"20",strokeDasharray:`${n} ${100-n}`,strokeDashoffset:-a,className:"transition-all duration-500"},t)})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:r}),e.jsx("div",{className:"text-xs text-gray-400",children:"Total"})]})})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-400",children:a.label}),e.jsxs("div",{className:"text-sm font-bold text-white",children:[a.value," (",Math.round(a.value/r*100),"%)"]})]})]},t))})]})},k=({data:s,color:r="#06b6d4"})=>{const a=Math.max(...s.map(o=>o.value),1),t=Math.min(...s.map(o=>o.value),0),l=a-t||1,n=s.map((o,c)=>{const d=c/(s.length-1)*100,h=100-(o.value-t)/l*100;return`${d},${h}`}).join(" ");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("svg",{className:"w-full h-64",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"lineGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:r,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:r,stopOpacity:"0.05"})]})}),e.jsx("polyline",{points:`0,100 ${n} 100,100`,fill:"url(#lineGradient)"}),e.jsx("polyline",{points:n,fill:"none",stroke:r,strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),s.map((o,c)=>{const d=c/(s.length-1)*100,h=100-(o.value-t)/l*100;return e.jsx("circle",{cx:d,cy:h,r:"1",fill:r,className:"hover:r-2 transition-all"},c)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 px-2",children:[e.jsx("span",{children:s[0]?.label}),e.jsx("span",{children:s[Math.floor(s.length/2)]?.label}),e.jsx("span",{children:s[s.length-1]?.label})]})]})},W=async()=>{const s=new Date,r=new Date(s.getFullYear(),s.getMonth(),1).toISOString().split("T")[0],a=new Date(s.getFullYear(),s.getMonth()-1,1).toISOString().split("T")[0],t=new Date(s.getFullYear(),s.getMonth(),0).toISOString().split("T")[0],{data:l,error:n}=await u.from("meetings").select("*");if(n)throw n;const{data:o,error:c}=await u.from("meetings").select("*").gte("meeting_date",r);if(c)throw c;const{data:d,error:h}=await u.from("meetings").select("*").gte("meeting_date",a).lte("meeting_date",t);if(h)throw h;const p=l?.length||0,N=o?.length||0,f=d?.length||0,S=f>0?(N-f)/f*100:0,C=l?.filter(m=>m.status==="pending").length||0,y=l?.filter(m=>m.status==="confirmed").length||0,M=l?.filter(m=>m.status==="completed").length||0,b=l?.filter(m=>m.status==="cancelled").length||0,_=p>0?(y+M)/p*100:0,T=l?.reduce((m,O)=>m+(O.duration||0),0)||0,$=p>0?T/p:0;return{totalMeetings:p,totalThisMonth:N,totalLastMonth:f,growthRate:Math.round(S*10)/10,pendingMeetings:C,confirmedMeetings:y,completedMeetings:M,cancelledMeetings:b,conversionRate:Math.round(_*10)/10,averageDuration:Math.round($)}},Q=async()=>{const{data:s,error:r}=await u.from("meetings").select("status");if(r)throw r;const a=s?.length||0,t={};return s?.forEach(l=>{t[l.status]=(t[l.status]||0)+1}),Object.entries(t).map(([l,n])=>({status:l,count:n,percentage:a>0?Math.round(n/a*100*10)/10:0}))},X=async()=>{const{data:s,error:r}=await u.from("meetings").select(`
      service_id,
      meeting_services (
        name,
        color
      )
    `);if(r)throw r;const a=s?.length||0,t={};return s?.forEach(l=>{const n=l.service_id,o=l.meeting_services?.name||"Sans service",c=l.meeting_services?.color||"#6B7280";t[n]||(t[n]={count:0,name:o,color:c}),t[n].count++}),Object.entries(t).map(([l,n])=>({service_id:l,service_name:n.name,count:n.count,percentage:a>0?Math.round(n.count/a*100*10)/10:0,color:n.color}))},Z=async()=>{const{data:s,error:r}=await u.from("meetings").select("meeting_channel");if(r)throw r;const a=s?.length||0,t={};return s?.forEach(l=>{const n=l.meeting_channel||"zoom";t[n]=(t[n]||0)+1}),Object.entries(t).map(([l,n])=>({channel:l,count:n,percentage:a>0?Math.round(n/a*100*10)/10:0}))},ee=async(s=30)=>{const r=new Date,a=new Date;a.setDate(a.getDate()-s);const{data:t,error:l}=await u.from("meetings").select("meeting_date, status").gte("meeting_date",a.toISOString().split("T")[0]).lte("meeting_date",r.toISOString().split("T")[0]).order("meeting_date");if(l)throw l;const n={};for(let o=0;o<s;o++){const c=new Date;c.setDate(c.getDate()-(s-1-o));const d=c.toISOString().split("T")[0];n[d]={count:0,confirmed:0,pending:0,cancelled:0}}return t?.forEach(o=>{const c=o.meeting_date;n[c]&&(n[c].count++,o.status==="confirmed"&&n[c].confirmed++,o.status==="pending"&&n[c].pending++,o.status==="cancelled"&&n[c].cancelled++)}),Object.entries(n).map(([o,c])=>({date:o,...c}))},te=async()=>{const{data:s,error:r}=await u.from("meetings").select("meeting_time");if(r)throw r;const a={};for(let t=8;t<=18;t++){const l=`${t.toString().padStart(2,"0")}:00`;a[l]=0}return s?.forEach(t=>{const l=t.meeting_time.substring(0,2)+":00";a[l]!==void 0&&a[l]++}),Object.entries(a).map(([t,l])=>({hour:t,count:l}))},se=async()=>{const{data:s,error:r}=await u.from("meetings").select("meeting_date, status");if(r)throw r;const a={},t=["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"];for(let l=11;l>=0;l--){const n=new Date;n.setMonth(n.getMonth()-l);const o=`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}`;`${t[n.getMonth()]}${n.getFullYear()}`,a[o]={count:0,confirmed:0,completed:0}}return s?.forEach(l=>{const n=l.meeting_date.substring(0,7);a[n]&&(a[n].count++,l.status==="confirmed"&&a[n].confirmed++,l.status==="completed"&&a[n].completed++)}),Object.entries(a).map(([l,n])=>{const[o,c]=l.split("-"),d=parseInt(c)-1;return{month:`${t[d]} ${o}`,...n}})},ne=async(s=10)=>{const{data:r,error:a}=await u.from("meetings").select("client_name, client_email, meeting_date").order("meeting_date",{ascending:!1});if(a)throw a;const t={};return r?.forEach(l=>{const n=l.client_name;t[n]||(t[n]={count:0,lastMeeting:l.meeting_date,email:l.client_email}),t[n].count++}),Object.entries(t).map(([l,n])=>({client_name:l,client_email:n.email,count:n.count,lastMeeting:n.lastMeeting})).sort((l,n)=>n.count-l.count).slice(0,s)},x={all:["analytics"],overview:["analytics","overview"],byStatus:["analytics","by-status"],byService:["analytics","by-service"],byChannel:["analytics","by-channel"],byDay:s=>["analytics","by-day",s],byHour:["analytics","by-hour"],byMonth:["analytics","by-month"],topClients:s=>["analytics","top-clients",s]},ae=()=>g({queryKey:x.overview,queryFn:W,staleTime:300*1e3,refetchInterval:300*1e3}),le=()=>g({queryKey:x.byStatus,queryFn:Q,staleTime:300*1e3}),re=()=>g({queryKey:x.byService,queryFn:X,staleTime:300*1e3}),oe=()=>g({queryKey:x.byChannel,queryFn:Z,staleTime:300*1e3}),ie=(s=30)=>g({queryKey:x.byDay(s),queryFn:()=>ee(s),staleTime:120*1e3}),ce=()=>g({queryKey:x.byHour,queryFn:te,staleTime:300*1e3}),de=()=>g({queryKey:x.byMonth,queryFn:se,staleTime:600*1e3}),me=(s=10)=>g({queryKey:x.topClients(s),queryFn:()=>ne(s),staleTime:300*1e3}),fe=()=>{const[s,r]=E.useState(30),{data:a}=V(),{data:t,isLoading:l}=ae(),{data:n,isLoading:o}=le(),{data:c,isLoading:d}=re(),{data:h,isLoading:p}=oe(),{data:N,isLoading:f}=ie(s),{data:S,isLoading:C}=ce(),{data:y,isLoading:M}=de(),{data:b,isLoading:_}=me(5);if(l)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(v,{})});const T={zoom:"#06b6d4","google-meet":"#10b981","microsoft-teams":"#8b5cf6","whatsapp-video":"#22c55e",phone:"#f59e0b"},$={pending:"#f59e0b",confirmed:"#10b981",completed:"#06b6d4",cancelled:"#ef4444",no_show:"#6b7280"},m=h?.map(i=>({label:i.channel,value:i.count,color:T[i.channel]||"#6b7280"}))||[],O=c?.map(i=>({label:i.service_name,value:i.count,color:i.color}))||[];n?.map(i=>({label:i.status,value:i.count,color:$[i.status]||"#6b7280"}));const q=S?.map(i=>({label:i.hour,value:i.count,color:"#06b6d4"}))||[],F=N?.map(i=>({label:new Date(i.date).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}),value:i.count}))||[];return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(K,{className:"w-8 h-8 text-cyan-400"}),"Analytics"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Vue d'ensemble complète de vos rendez-vous"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-2 bg-white/5 rounded-lg p-1",children:[30,60,90].map(i=>e.jsxs("button",{onClick:()=>r(i),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${s===i?"bg-cyan-500 text-white":"text-gray-400 hover:text-white"}`,children:[i,"j"]},i))}),e.jsx(J,{data:a||[],filename:`analytics-${new Date().toISOString().split("T")[0]}`,title:"Analytics - Rendez-vous",disabled:!a||a.length===0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(D,{title:"Total Rendez-vous",value:t?.totalMeetings||0,icon:e.jsx(z,{className:"w-6 h-6"}),color:"#06b6d4",subtitle:"Tous les temps"}),e.jsx(D,{title:"Ce mois-ci",value:t?.totalThisMonth||0,change:t?.growthRate,icon:e.jsx(R,{className:"w-6 h-6"}),color:"#10b981",subtitle:`${t?.totalLastMonth||0} le mois dernier`}),e.jsx(D,{title:"Taux de conversion",value:`${t?.conversionRate||0}%`,icon:e.jsx(H,{className:"w-6 h-6"}),color:"#8b5cf6",subtitle:`${t?.confirmedMeetings||0} confirmés`}),e.jsx(D,{title:"Durée moyenne",value:`${t?.averageDuration||0} min`,icon:e.jsx(Y,{className:"w-6 h-6"}),color:"#f59e0b",subtitle:"Par rendez-vous"})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-cyan-400"}),"Répartition par statut"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[e.jsx(w,{status:"pending",count:t?.pendingMeetings||0}),e.jsx(w,{status:"confirmed",count:t?.confirmedMeetings||0}),e.jsx(w,{status:"completed",count:t?.completedMeetings||0}),e.jsx(w,{status:"cancelled",count:t?.cancelledMeetings||0}),e.jsx(w,{status:"no_show",count:0})]})]}),e.jsx(j,{title:"Évolution des rendez-vous",subtitle:`${s} derniers jours`,children:f?e.jsx(v,{}):e.jsx(k,{data:F,color:"#06b6d4"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(j,{title:"Par service",subtitle:"Répartition des rendez-vous",children:d?e.jsx(v,{}):e.jsx(U,{data:O})}),e.jsx(j,{title:"Par canal de communication",subtitle:"Préférences clients",children:p?e.jsx(v,{}):e.jsx(L,{data:m})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(j,{title:"Heures de pointe",subtitle:"Rendez-vous par heure",children:C?e.jsx(v,{}):e.jsx(L,{data:q})}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-400"}),"Top Clients"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Clients les plus actifs"})]}),_?e.jsx(v,{}):e.jsxs("div",{className:"space-y-3",children:[b?.map((i,B)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center text-white font-bold text-sm",children:B+1}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:i.client_name}),e.jsx("div",{className:"text-xs text-gray-400",children:i.client_email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-cyan-400 font-bold",children:i.count}),e.jsx("div",{className:"text-xs text-gray-400",children:"RDV"})]})]},B)),(!b||b.length===0)&&e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Aucun client pour le moment"})]})]})]}),!M&&y&&y.length>0&&e.jsx(j,{title:"Tendance annuelle",subtitle:"12 derniers mois",children:e.jsx(k,{data:y.map(i=>({label:i.month,value:i.count})),color:"#8b5cf6"})})]})};export{fe as A};
